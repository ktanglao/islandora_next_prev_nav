<?php

function next_prev_islandora_view_object_alter(&$object, &$rendered){
  if(in_array('islandora:collectionCModel', $object->models)){
    return;
  }
  else{
    $button = function($target_pid){
      $string = "<button><a href='/islandora/object/$target_pid'>$target_pid</a></button>";
      return $string;
    };
    $rendered[null]['#markup'] = $rendered[null]['#markup'] . $button(get_next_or_prev($object->id,'p')) . $button(get_next_or_prev($object->id,'n'));
    get_list_isMemberOf($object->id);
    dpm($rendered);
  }
}

function get_list_isMemberOf($pid){
  $rels_predicate = variable_get('islandora_collection_object_relationship', 'isMemberOf');
  $objects = array();
  $connection = islandora_get_tuque_connection();
  $pid_parts = explode(":", $pid);
  $escaped_pid = str_replace(':', '_', $pid);
  if ($connection) {
    $query = <<<EOQ
  SELECT ?object ?label FROM <#ri>
  WHERE {
    ?object <fedora-model:label> ?label;
            <fedora-rels-ext:isMemberOfCollection> <info:fedora/$pid_parts[0]:collection>
  }
  ORDER BY ?label
EOQ;
 $results = $connection->repository->ri->sparqlQuery($query);
  }
 dpm($results);
 return $results;
}

function get_next_or_prev($pid, $op){
  $pid_part = explode(":", $pid); 
  if($op == 'n'){
  $pid_incr = $pid_part[1] + 1;
  }
  else{
  $pid_incr = $pid_part[1] - 1;
}
  $next = $pid_part[0].":".$pid_incr;
  return $next;
}

?>
